import{r as n,j as t,a as V,n as i,d as W}from"./app-DnwVPCvX.js";import{s as U}from"./index-C4JomMCi.js";const K=({videoId:p,taskId:u,order:e,onTaskCompleted:x})=>{const d=n.useRef(null),[g,P]=n.useState(0),[v,b]=n.useState(!1),[I,N]=n.useState(""),[T,k]=n.useState(""),[A,R]=n.useState(0),[h,j]=n.useState(!1);n.useState(!1);const[w,y]=n.useState(0),l=n.useRef(null),m=n.useRef(null),C=2,f=async(r,o)=>{try{await V.post(U("client.dashboard.tasks.update"),{taskId:r,status:o})}catch(c){console.error("Failed to update task:",c),i.error("Failed to update task status. Please try again.")}},D=r=>{console.error("YouTube Player Error:",r.data),i.error("An error occurred with the YouTube player.")},Y=()=>{if(l.current){const r=l.current.getCurrentTime();if(e.order_type==="custom_time"){if(r<e.time_start-.5){l.current.seekTo(e.time_start,!0),i.error("You cannot seek before the start time!",{duration:2e3}),y(e.time_start);return}if(r>e.time_end+.5){l.current.seekTo(e.time_end,!0),i.error("You cannot seek past the end time!",{duration:2e3}),i.error("try again Good Luck",{duration:2e3}),x(),y(e.time_end);return}}const o=Math.abs(r-w);o>C&&o<30?(console.log("Seek detected:",{currentTime:r,lastAllowedTime:w}),l.current.seekTo(w,!0),i.error("Seeking is not allowed!",{duration:2e3})):y(r)}};n.useEffect(()=>()=>{m.current&&clearInterval(m.current)},[]),n.useEffect(()=>{var c;const r=document.createElement("script");r.src="https://www.youtube.com/iframe_api";const o=document.getElementsByTagName("script")[0];(c=o.parentNode)==null||c.insertBefore(r,o),window.onYouTubeIframeAPIReady=()=>{!h&&d.current&&new YT.Player(d.current,{videoId:p,playerVars:{start:e.order_type==="custom_time"?e.time_start:0,end:e.order_type==="custom_time"?e.time_end:0,autoplay:0,controls:1,modestbranding:1,rel:0,fs:1,iv_load_policy:3,disablekb:0},events:{onReady:onPlayerReady,onError:D,onStateChange:onPlayerStateChange}})}},[p,u,e]),n.useEffect(()=>{var _;const r=document.createElement("script");r.src="https://www.youtube.com/iframe_api";const o=document.getElementsByTagName("script")[0];(_=o.parentNode)==null||_.insertBefore(r,o),window.onYouTubeIframeAPIReady=()=>{!h&&d.current&&new YT.Player(d.current,{videoId:p,playerVars:{start:e.order_type==="custom_time"?e.time_start:0,end:e.order_type==="custom_time"?e.time_end:0,autoplay:0,controls:0,showinfo:0,modestbranding:1,rel:0,fs:0,iv_load_policy:3,disablekb:1},events:{onReady:O,onError:c,onStateChange:async a=>{a.data===YT.PlayerState.PAUSED&&a.target.playVideo(),a.data===YT.PlayerState.PLAYING&&(await f(u,"in_progress"),F()),a.data===YT.PlayerState.ENDED&&B()}}})};const c=a=>{console.error("Error Occurred:",a.data)},O=a=>{a.target.playVideo(),l.current=a.target;const s=e.order_type==="custom_time"?e.time_start:0;y(s),a.target.seekTo(s,!0),m.current&&clearInterval(m.current),m.current=setInterval(Y,1e3)},B=async()=>{const a=Math.floor(Math.random()*10)+1,s=Math.floor(Math.random()*10)+1;R(a+s),N(`${a} + ${s}`),b(!0)},F=()=>{const a=e.order_type==="custom_time"?e.time_end-e.time_start:JSON.parse(e.data).minutes*60;let s=0;const M=setInterval(()=>{s>=100?(clearInterval(M),b(!0)):(s++,P(s))},a*10)},S=async()=>{document.visibilityState==="hidden"&&(console.log("hidden"),j(!0),await f(u,"failed"))};document.addEventListener("visibilitychange",S);const E=a=>{const s="Are you sure you want to leave? Your progress will be lost.";return a.preventDefault(),f(u,"failed"),s};return window.addEventListener("beforeunload",E),()=>{document.removeEventListener("visibilitychange",S),delete window.onYouTubeIframeAPIReady,window.removeEventListener("beforeunload",E)}},[p]);const L=async()=>{parseInt(T)===A?(await f(u,"completed"),i.success("Task Completed Thanks For Watching",{position:"top-right",duration:5e3}),x(),W.Inertia.reload()):i.error("Incorrect answer. Please try again.",{position:"top-right",duration:5e3})};return t.jsxs(t.Fragment,{children:[t.jsx("center",{children:t.jsx("span",{className:"text-center text-2xl font-bold",children:"NOT ALLOWED TO MOVE OR CLOSE THE WINDOW UNTIL THE TASK IS COMPLETED"})}),t.jsx("div",{style:h?{display:"none",width:"0%",height:"0%"}:{height:"60%"},className:"w-full mt-4",ref:d}),h&&t.jsx("div",{style:{height:"60%"},className:"w-full mt-4",id:"player-hidden",children:t.jsxs("center",{children:[t.jsx("img",{src:"https://www.freeiconspng.com/uploads/shiny-metal-red-error-image-designs-1.png",width:"350"}),t.jsxs("span",{className:"text-2xl font-bold",children:["KINDLY RELOAD THE PAGE AND CLICK AGAIN ON 'VIEW TASK'",t.jsx("br",{})," IF YOU FOUND IT ðŸ˜…"]})]})}),t.jsx("div",{className:"w-full h-[20px] bg-gray-300 rounded-full mt-4 relative",children:t.jsx("div",{className:"h-[20px] bg-green-500 rounded-full transition-all duration-300 ease-in-out",style:{width:`${g}%`},children:t.jsxs("span",{className:"absolute right-0 text-xs text-black pr-2",children:[g,"%"]})})}),v&&g===100&&t.jsxs("div",{style:{marginTop:"1rem",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"white",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",borderRadius:"0.5rem",padding:"1rem"},children:[t.jsxs("p",{style:{fontSize:"1rem",marginRight:"0.5rem",display:"flex",alignItems:"center",marginBottom:"0.5rem"},children:["Solve this:"," ",t.jsx("span",{style:{color:"#1D4ED8",marginLeft:"0.25rem",fontSize:"1rem"},children:I})]}),t.jsx("input",{style:{width:"100%",maxWidth:"300px",border:"1px solid #D1D5DB",borderRadius:"0.375rem",padding:"0.5rem",outline:"none",boxShadow:"0 0 0 2px rgba(59, 130, 246, 0.5)",marginRight:"0.5rem",marginBottom:"0.5rem"},type:"text",value:T,onChange:r=>k(r.target.value),placeholder:"Your answer"}),t.jsx("button",{onClick:L,style:{backgroundColor:"#3B82F6",color:"white",transition:"all 0.3s",width:"12%",maxWidth:"auto",fontSize:"1rem",padding:"0.5rem 1rem",borderRadius:"0.375rem"},children:"Submit"})]})]})};export{K as default};
