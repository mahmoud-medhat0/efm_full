import{r as o,u as A,_ as s,j as e,a as F,d as R}from"./app-CRzte3xH.js";import{M as q}from"./MethodSelector-CSSl_8sm.js";import{W as B}from"./WelcomeTab-C1mhnP_0.js";import{B as y}from"./Button-BwLSSHyX.js";import{I as v}from"./Input-CHzivGqD.js";import H from"./Layout-Bcm-wSnR.js";import{M as J}from"./Modal-f4DqSz2l.js";import{u as M}from"./index.esm-DVAkflkl.js";import{s as w}from"./index-C4JomMCi.js";import"./listbox-CIEw22uG.js";import"./use-is-mounted-CM4-4v2X.js";import"./form-fields-BiOU4Ey8.js";import"./use-text-value-9tTb54_S.js";import"./use-inert-others-BFqfSEku.js";import"./transition-Cr4uNon6.js";import"./floating-ui.dom-BHs9XJpa.js";import"./character-B_L2WyuU.js";import"./LinkIcon-DoQ5kAJp.js";import"./Footer-B9GXSskN.js";import"./twitter-C2_HC0eX.js";import"./Navbar-COYv8RX2.js";import"./logo-D1jq1p5V.js";import"./ShoppingCartIcon-C9DSrvBf.js";import"./DocumentCheckIcon-DV8PTXac.js";import"./XMarkIcon-BtOH0mX8.js";function K({title:x,titleId:i,...t},f){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":i},t),x?o.createElement("title",{id:i},x):null,o.createElement("path",{fillRule:"evenodd",d:"M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"}))}const X=o.forwardRef(K),ye=()=>{const i=A().props.methods,[t,f]=o.useState(i[0]),[l,E]=o.useState(),[_,N]=o.useState(0),b=()=>{if(l>0){let a=0;t.charge_type_withdraw==="percentage"?a=parseFloat(l)*t.charge_withdraw/100:a=parseFloat(t.charge_withdraw);const n=parseFloat(l)-a;N(n>0?n:0)}else N(0)},S=a=>{const n=parseFloat(a.target.value);E(n)};o.useEffect(()=>{b()},[l,t]);const[C,h]=o.useState(!1),[O,g]=o.useState(!1),k=()=>g(!0),j=()=>g(!1);A().props;const{register:T,handleSubmit:W,setError:Y,formState:{errors:Z}}=M(),L=async a=>{var n,d,c,p;try{a.selectedMethod=t.id;const r=await F.post(w("client.dashboard.withdraw-account"),a);(r.status===200||r.status===201)&&r.data.success?(s.success(r.data.message,{position:"bottom-center",duration:2e3}),j(),h(!1),R.Inertia.visit(w("client.dashboard.withdraw"))):r.data.success===!1?r.data.errors?Object.keys(r.data.errors).forEach(m=>{r.data.errors[m].forEach(u=>{s.error(u,{position:"bottom-center",duration:2e3})})}):s.error(r.data.message||"An error occurred",{position:"bottom-center",duration:2e3}):s.error(r.data.message||"An error occurred",{position:"bottom-center",duration:2e3})}catch(r){console.error("Error during withdraw account creation:",r);const m=r,u=((c=(d=(n=m.response)==null?void 0:n.data.error)==null?void 0:d.details)==null?void 0:c.message)||((p=m.response)==null?void 0:p.data.message)||"An error occurred during withdraw account creation";s.error(`Withdraw account creation failed: ${u}`,{position:"bottom-center",duration:3e3})}};o.useEffect(()=>{console.log(t.withdrawAccounts.length),t.withdrawAccounts.length==0&&(s.error("You don't have any withdraw accounts. Please add one to proceed.",{position:"bottom-center",duration:3e3}),k())},[]);const I=a=>{f(a),t.withdrawAccounts.length==0&&(s.error("You don't have any withdraw accounts. Please add one to proceed.",{position:"bottom-center",duration:3e3}),k())},{register:$,handleSubmit:D,formState:{errors:z}}=M(),P=async a=>{var n;h(!0);try{const d=(n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content");if(!t){h(!1),s.error("Please select a withdrawal method");return}if(l<=0){h(!1),s.error("Please enter an amount");return}const c=new FormData;c.append("selectedMethod",t.id),c.append("amount",l),c.append("account_id",t.withdrawAccounts[0].id);const p={headers:{"X-CSRF-TOKEN":d,"Content-Type":"multipart/form-data"}},r=await F.post(w("client.dashboard.withdraw.post"),c,p);r.data.success?(s.success(r.data.message+" with transaction id: "+r.data.tnx),setTimeout(()=>{window.location.replace(w("client.dashboard"))},1e3)):Object.keys(r.data.errors).forEach(m=>{r.data.errors[m].forEach(u=>{s.error(u,{position:"bottom-center",duration:2e3})})})}catch(d){console.error("Error submitting form:",d)}finally{h(!1)}};return e.jsx(H,{children:e.jsxs("div",{children:[e.jsx(B,{}),e.jsxs("div",{className:"w-full px-2 py-12 sm:px-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg mb-5",children:"Withdraw funds"}),e.jsx("div",{className:"flex justify-end mb-4",children:t.withdrawAccounts&&t.withdrawAccounts.length==0&&e.jsx(y,{onClick:()=>g(!0),children:"Add Withdraw Account"})})]}),t&&t.description_withdraw!=null&&t.description_withdraw!=""&&e.jsxs("div",{className:"space-y-2 pb-1",children:[e.jsx("label",{htmlFor:"description",className:"text-black text-base",children:"Description"}),e.jsx("div",{id:"description",style:{border:"3px solid black",backgroundColor:"white"},dangerouslySetInnerHTML:{__html:t.description_withdraw}})]}),t.withdrawAccounts&&t.withdrawAccounts.length>0&&t.withdrawAccounts.map(a=>e.jsxs("div",{className:"space-y-2 pb-1",children:[e.jsx("label",{htmlFor:"",className:"text-black text-base",children:Object.keys(JSON.parse(a.data))[0]}),e.jsx("div",{id:"",style:{border:"1.5px solid black",backgroundColor:"white"},dangerouslySetInnerHTML:{__html:Object.values(JSON.parse(a.data))[0]}})]})),e.jsxs("div",{className:"pb-3",children:[e.jsxs("form",{className:"space-y-3",onSubmit:D(P),children:[e.jsxs("div",{className:"space-y-2 pb-1",children:[e.jsx("label",{htmlFor:"plan",className:"text-black text-base",children:"Method"}),i.length>0&&e.jsx(q,{methods:i,onChange:I})]}),e.jsxs("div",{className:"space-y-2 pb-1",children:[e.jsx("label",{htmlFor:"amount",className:"text-black text-base",children:"Amount"}),e.jsx(v,{id:"amount",type:"number",placeholder:"0.00",onChange:S,onInput:S,onKeyDown:a=>{a.key==="Enter"&&a.preventDefault(),b()}})]}),e.jsxs("div",{className:"space-y-2 pb-1",children:[e.jsx("label",{htmlFor:"total",className:"text-black text-base",children:"Total"}),e.jsx(v,{id:"total",value:_.toFixed(2),readOnly:!0})]}),e.jsx("div",{className:"flex flex-row gap-3",children:e.jsx(y,{fullWidth:!0,isLoading:C,children:"Withdraw"})})]}),t.withdrawFields&&t.withdrawFields.length>0&&t.withdrawAccounts.length==0&&e.jsxs(J,{isOpen:O,closeModal:j,children:[e.jsx("div",{className:"absolute top-[-20px] right-0",children:e.jsx("div",{className:"bg-[#E8F0F7] rounded-full p-1",children:e.jsx(X,{className:"w-6 h-6 cursor-pointer text-red-600",onClick:j})})}),e.jsx("h2",{className:"text-black text-2xl font-medium mb-2",children:"Add Withdraw Account"}),e.jsxs("form",{className:"flex flex-col items-center justify-center space-y-5 pt-10 px-5",children:[e.jsx("p",{className:"text-center mt-4",children:"The Selected Method has the following fields:"}),e.jsx("div",{className:"w-full flex-row items-center gap-2 p-2 rounded-lg",children:t.withdrawFields.map(a=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:a.name.en,className:"text-black text-base",children:a.name.en}),e.jsx(v,{...T(a.name.en),placeholder:a.name.en,type:a.type,required:a.required})]},a.id))}),e.jsx("div",{className:"w-full",children:e.jsx(y,{fullWidth:!0,onClick:W(L),children:"Save Changes"})})]})]})]})]})]})})};export{ye as default};
