import{u as j,r as c,j as e,a as N,_ as C,d as T}from"./app-DnwVPCvX.js";import{D as _}from"./DashboardLayout-B4xzSw_q.js";import{s as y}from"./index-C4JomMCi.js";import"./character-B_L2WyuU.js";const B="/build/assets/send%20icon-DRkvxINc.svg",I="/build/assets/ATTCHMENT%20ICON-BMLLp56V.svg",S=()=>{const{ticket:s,ticketMessages:d}=j().props,[i,m]=c.useState(""),[r,l]=c.useState(null),[h,o]=c.useState(null),[g,u]=c.useState(!1),n=c.useRef(null);c.useEffect(()=>{const a=setTimeout(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},1e3);return()=>clearTimeout(a)},[d]);const k=t=>{const a=t.target.files[0];if(a){l(a);const p=new FileReader;p.onload=v=>{o(v.target.result)},p.readAsDataURL(a)}},x=()=>{l(null),o(null)},f=async()=>{if(i.trim()===""&&!r)return;const t=new FormData;t.append("ticket_id",s.id),t.append("message",i),r&&t.append("image",r);const a=await N.post(y("client.dashboard.ticket.message.store"),t,{headers:{"Content-Type":"multipart/form-data"}});a.data.success?(m(""),l(null),o(null)):C.error(a.data.message),T.Inertia.reload()};return e.jsx(_,{children:e.jsxs("div",{className:"chatticket-container",children:[e.jsxs("h1",{className:"chatticket-title",children:[s.title," - ",s.ticket_id," - ",e.jsx("span",{className:"chatticket-statusBadge",children:s.status})]}),e.jsx("div",{className:"chatticket-chatContainer",ref:n,children:d.map(t=>e.jsxs("div",{className:t.message_from==="admin"?"chatticket-adminMessageContainer":"chatticket-userMessageContainer",children:[e.jsxs("div",{className:`chatticket-messageBubble ${t.message_from==="admin"?"chatticket-userBubble":""}`,children:[e.jsx("p",{className:"chatticket-messageText",children:t.message}),t.image&&e.jsx("img",{src:t.image_url,alt:"attachment",className:"chatticket-image"}),e.jsx("span",{className:"chatticket-messageTime",children:t.created_at_human})]}),t.message_from==="user"&&t.client&&e.jsx("img",{src:t.client.profile_image_url,alt:"User Avatar",className:"chatticket-avatar"})]},t.id))}),h&&e.jsxs("div",{className:"chatticket-attachmentPreview",children:[e.jsx("img",{src:h,alt:"Uploaded Attachment",className:"chatticket-previewImage"}),e.jsx("button",{className:"chatticket-removeButton",onClick:x,children:"Remove"})]}),s.status=="open"||s.status=="pending"?e.jsxs("div",{className:"chatticket-inputContainer",children:[e.jsx("img",{src:I,alt:"Attachment Icon",className:"chatticket-attachmentIcon",onClick:()=>document.getElementById("fileUpload").click()}),e.jsx("input",{id:"fileUpload",type:"file",style:{display:"none"},onChange:k}),e.jsx("input",{type:"text",placeholder:"Type your message here...",value:i,onChange:t=>m(t.target.value),className:"chatticket-inputField"}),e.jsx("button",{className:`chatticket-sendButton ${g?"chatticket-sendButtonHover":""}`,onClick:f,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:e.jsx("img",{className:"chatticket-sendIcon",src:B,alt:"Send Icon"})})]}):e.jsx("div",{children:e.jsx("p",{children:"لا يمكنك الرد على هذا التذكرة"})})]})})};export{S as default};
