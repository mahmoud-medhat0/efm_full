import{u as E,r as a,j as e,n as i,a as b}from"./app-CRzte3xH.js";import P from"./ytiframeapi-D2GCBpiw.js";import R from"./ModalTask-B2-Ey_dB.js";import{D as z}from"./DashboardLayout-Clkfwr22.js";import{F as T}from"./XMarkIcon-BtOH0mX8.js";import"./index-C4JomMCi.js";import"./character-B_L2WyuU.js";const K=()=>{const{tasks:d,categories:c,app_url:w}=E().props,[l,_]=a.useState("All"),[C,u]=a.useState(!1),[y,p]=a.useState(!1),[M,m]=a.useState(""),[o,n]=a.useState(""),[S,h]=a.useState({}),[I,F]=a.useState(""),[A,B]=a.useState(""),[x,$]=a.useState(),j=s=>{_(s)},v=l==="All"?d:d.filter(s=>s.service_name===l),O=async(s,t)=>{try{await b.post(route("client.dashboard.tasks.update"),{taskId:s,status:t})}catch(r){console.error("Failed to update task:",r),i.error("Failed to update task status. Please try again.")}},V=(s,t,r,N)=>{m(s),n(t),u(!0),h(r),CloseModal()},k=async()=>{u(!1),m(""),n(""),h({}),await O(o,"failed"),window.location.reload()},D=(s,t,r,N)=>{p(!0),n(s),F(t),B(r),$(N)},f=()=>{p(!1)},g=s=>{b.post(route("client.dashboard.tasks.status"),{taskId:s.id}).then(t=>t.data.status)};return e.jsxs(z,{children:[e.jsxs("div",{className:"tasks-tasksContainer",children:[e.jsx("h2",{className:"tasks-tasksTitle",children:"Tasks"}),e.jsxs("div",{className:"tasks-tasksFilterButtons",children:[e.jsx("button",{className:`tasks-tasksButton ${l==="All"?"tasks-tasksButtonActive":""}`,onClick:()=>j("All"),children:"All"}),c.length>0?c.map(s=>e.jsx("button",{className:`tasks-tasksButton ${l===s.service_name?"tasks-tasksButtonActive":""}`,onClick:()=>j(s.service_name),children:s.service_name},s.service_id)):e.jsx("p",{children:"No categories available"})]}),v.length>0?v.map(s=>e.jsxs("div",{className:"tasks-tasksCard",children:[s.data!=null&&s.data.thumbnail!=null?e.jsx("img",{src:`${s.data.thumbnail}`,alt:`Task ${s.id}`,className:"tasks-tasksImage"}):e.jsx("img",{src:`${w}/storage/${s.service_thumbnail}`,alt:`Task ${s.id}`,className:"tasks-tasksImage"}),e.jsxs("div",{className:"tasks-tasksDetails",children:[e.jsx("h3",{children:s.order.service.name.en}),e.jsxs("p",{children:[e.jsx("span",{children:"Commission:"})," ",s.reward]}),e.jsxs("p",{children:[e.jsx("span",{children:"Category:"})," ",s.service_name]}),e.jsxs("p",{children:[e.jsx("span",{children:"Time:"})," ",s.order.created_at_human]}),e.jsxs("p",{children:[e.jsx("span",{children:"Current/Target:"})," ",s.order.current_amount,"/",s.order.target_amount]}),s.rejection_cause_name!==null&&e.jsxs("p",{style:{color:"red"},children:[e.jsx("span",{children:"Rejection Cause:"})," ",s.rejection_cause_name]})]}),e.jsxs("div",{className:"tasks-tasksButtons",children:[s.status==="pending"||s.status==="in_progress"||s.status==="failed"?e.jsx("p",{className:"tasks-tasksViewTask",onClick:()=>{if(g(s)==="completed"){i.error("Sorry Task is completed");return}if(g(s)==="expired"){i.error("Sorry Task is expired");return}s.service_code==="yt_videos"?V(s.data.videoId,s.id,s.order):s.service_type==="manual"?D(s.id,s.description,s.instructions,s.fields):i.error("Task is not a supported type")},children:"View Task"}):e.jsx("p",{className:"tasks-tasksViewTask",children:"View Task"}),e.jsx("button",{className:"tasks-tasksCancelled",children:s.status.replace("_"," ").toUpperCase()})]})]},s.id)):e.jsx("p",{children:"No tasks available"})]}),C&&e.jsx("div",{className:"fixed z-50 inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg relative w-[75%] h-[95%]",children:[e.jsx("div",{className:"absolute top-[0px] right-[1px]",children:e.jsx("div",{className:"bg-[#E8F0F7] rounded-full p-1",children:e.jsx(T,{className:"w-6 h-6 cursor-pointer text-red-600",onClick:k})})}),e.jsx("div",{className:"relative overflow-hidden mt-1 h-[100%]",children:e.jsx(P,{videoId:M,taskId:o,order:S,onTaskCompleted:k,fields:x})})]})}),y&&e.jsx("div",{className:"fixed z-50 inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg relative w-[75%] h-[95%]",children:[e.jsx("div",{className:"absolute top-[0px] right-[1px]",children:e.jsx("div",{className:"bg-[#E8F0F7] rounded-full p-1",children:e.jsx(T,{className:"w-6 h-6 cursor-pointer text-red-600",onClick:f})})}),e.jsx("div",{className:"relative overflow-hidden mt-4 h-[100%] overflow-y-scroll",children:e.jsx(R,{taskId:o,description:I,instructions:A,onTaskCompleted:f,fields:x})})]})})]})};export{K as default};
